<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Game of Nim &bull; Will Bennion (22925040)</title>
		<link href="css/bootstrap.min.css" rel="stylesheet" />
		<link href="css/app.css" rel="stylesheet" />
	</head>
	<body>
		<div id="app">
			<nav class="navbar navbar-dark bg-dark justify-content-between">
				<div class="navbar-brand">Game of Nim</div>
				<div>Will Bennion (22925040)</div>
			</nav>

			<div class="main-container">
				<router-view></router-view>
			</div>

			<bs-modal id="app-loading-modal" title="Loading" v-bind:close-button="false" data-backdrop="static" data-keyboard="false">
				<p>One sec, we're working on it...</p>
			</bs-modal>

			<bs-modal id="network-error-modal" title="Network Error" v-bind:buttons="[{label:'Reload', class:'btn-primary', callback: reload}]" v-bind:close-button="false" data-backdrop="static" data-keyboard="false">
				<p>You have been disconnected from the server.</p>
			</bs-modal>
		</div>

		<!-- Welcome view -->
		<script type="text/x-template" id="view-welcome">
			<div class="jumbotron">
				<h1 class="display-3">Welcome!</h1>
				<p class="lead">The game of Nim is a game where players must remove one or more objects from a pile. The losing player is the player to take the last item. In this variant you must take atleast one object, but may take up to half of the total objects remaining.</p>
				<hr class="my-4">
				<form v-on:submit.prevent="enterName">
					<div class="form-group">
						<label for="player-name">Enter your name below to get started!</label>
						<input type="text" class="form-control" id="player-name" placeholder="What do we call you?" v-model="$store.state.username">
					</div>
					<p class="lead">
						<button class="btn btn-primary" type="submit">Play!</button>
					</p>
				</form>
			</div>
		</script>

		<!-- Lobby view -->
		<script type="text/x-template" id="view-lobby">
			<div class="row h-100">
				<chat-panel></chat-panel>
				<div class="col">
					<div class="d-flex flex-column h-100 position-relative">
						<h4 class="m-2">Games</h4>
						<ul class="list-group p-2 fg-1 game-lobby-list">
							<li v-for="lobby in $store.state.lobbies" class="list-group-item p-2 d-flex justify-content-between align-items-center">
								{{lobby.player1}} vs {{lobby.player2}}
								<button type="button" class="btn btn-info btn-sm" v-bind:class="{disabled:$store.state.inGameLobby==lobby.gameId}" v-on:click.prevent="joinGameLobby(lobby.gameId)">Join</button>
							</li>
						</ul>

						<!-- Host game settings panel -->
						<div class="card m-2 create-game-popover" v-bind:class="[showCreateGamePopover?'':'out']">
							<div class="card-body">
								<button type="button" class="close" v-on:click.prevent="showCreateGamePopover=false;"><span>&times;</span></button>
								<h4 class="card-title">Create Game</h4>
								<h6 class="card-subtitle mb-2 text-muted">Host a game for another player to join, or get some practice against the AI</h6>
								<form v-on:submit.prevent="submitCreateGameLobby">
									<!-- Difficulty setting -->
									<div class="form-group row">
										<label class="col-sm-4 col-form-label">Difficulty</label>
										<div class="btn-group" data-toggle="buttons">
											<label class="btn btn-outline-primary active">
												<input type="radio" name="difficultyOptions" value="easy" checked> Easy
											</label>
											<label class="btn btn-outline-primary">
												<input type="radio" name="difficultyOptions" value="hard"> Hard
											</label>
										</div>
									</div>
									<!-- Opponent setting -->
									<div class="form-group row">
										<label class="col-sm-4 col-form-label">Oponent</label>
										<div class="btn-group" data-toggle="buttons">
											<label class="btn btn-outline-primary active">
												<input type="radio" name="opponentOptions" value="human" checked> Human
											</label>
											<label class="btn btn-outline-primary">
												<input type="radio" name="opponentOptions" value="ai"> AI
											</label>
										</div>
									</div>
									<!-- Host button -->
									<div class="form-group row justify-content-center">
										<div class="col-sm-5">
											<button type="submit" class="btn btn-block btn-info">Play</button>
										</div>
									</div>
								</form>
							</div>
						</div>

						<div class="p-2" v-if="$store.state.inGameLobby==-1">
							<button type="button" class="btn btn-primary btn-block" v-on:click.prevent="showCreateGamePopover=true;">Create Game</button>
						</div>

						<div class="card text-white bg-dark m-2 p-2" v-if="$store.state.inGameLobby!=-1">
							<div class="card-body p-1">
								Waiting on another player&hellip;
							</div>
						</div>
					</div>
				</div>
			</div>
		</script>

		<!-- Game view -->
		<script type="text/x-template" id="view-game">
			<div class="row h-100">
				<chat-panel></chat-panel>
				<div class="col">
					<h4 class="m-2">Game</h4>
				</div>
			</div>
		</script>

		<!-- Custom templates -->
		<script type="text/x-template" id="template-chat-panel">
			<div class="col-6">
				<div class="d-flex flex-column h-100">
					<h4 class="m-2">Chat</h4>
					<div class="card m-2 p-2 fg-1">
						<div class="card-body chat-history p-0">
							<div v-for="msg in $store.state.messages" class="chat-message">
								<span class="text-muted">[{{msg.time | date}}]</span>
								<span class="text-danger font-weight-bold">{{msg.from}}:</span>
								<span class="text-dark">{{msg.message}}</span>
							</div>
						</div>
					</div>
					<form class="p-2" v-on:submit.prevent="submitMessage">
						<div class="input-group">
							<input type="text" class="form-control" placeholder="Message..." v-model="messageInput">
							<span class="input-group-btn"><button class="btn btn-primary" type="submit">Send</button></span>
						</div>
					</form>
				</div>
			</div>
		</script>

		<script type="text/x-template" id="template-bs-modal">
			<div class="modal" tabindex="-1">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">{{title}}</h5>
							<button v-if="closeButton!==false" type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<slot></slot>
						</div>
						<div class="modal-footer" v-if="buttons">
							<button v-for="btn in buttons" v-bind:class="['btn', btn.class || 'btn-default']" v-bind:data-dismiss="btn.close ? 'modal' : ''" v-on:click="btn.callback ? btn.callback() : null">{{btn.label}}</button>
						</div>
					</div>
				</div>
			</div>
		</script>

		<!-- Import required JavaScript -->
		<script src="js/vue.js"></script>
		<script src="js/vuex.min.js"></script>
		<script src="js/vue-router.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/app.js"></script>
	</body>
</html>